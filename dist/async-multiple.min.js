!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["async-multiple"]=t():e["async-multiple"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=s(r(5)),a=s(r(6)),u=r(7);function s(e){return e&&e.__esModule?e:{default:e}}function c(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var l=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e._defaultParams={task:{type:[Array,Object],default:[]},rejectOnError:{type:Boolean,default:!1},handleStart:function(){},handleEnd:function(){},randomStep:{type:Boolean,default:!1},stepBettwen:{type:[Array,Number],default:0,min:0},stepTimeout:{type:Number,default:void 0,min:0},errorReplace:void 0,errorRetry:{type:Number,default:0,min:0},maxSuccessCount:{type:Number,default:void 0},showProgress:{type:Boolean,default:!1},alias:{type:String,default:"TASK_"+e.randomString(8)},debug:{type:Boolean,default:!1}},e._formatType="each",e._stopAtNextTrick=!1,e._actionName=e.randomString(8);for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];return e._checkParams(n),e._initTask(),e._initHooks(),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default),o(t,[{key:"start",value:function(){var e=this;return this._beginTask().then(function(t){var r=(0,a.default)(t,"order",!1),n={},o=r.map(function(t){return n["map"===e._formatType?t.input:t.order]=t.output,t.output});return Promise.resolve({response:t,allObject:n,allArray:r,outputArray:o,toObject:function(){return n},toArray:function(){return r}})})}},{key:"cancelTask",value:function(){this._debug("Calling the cancelTask method, task will stop at next trick!"),this._stopAtNextTrick=!0}},{key:"_assign",value:function(e){for(var t=this,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return n=n.map(function(r){if(t.isType(r,{})){var n={};for(var o in r){var i=r[o];t.isType(i,{})?e.hasOwnProperty(o)||(n[o]=t.isType(i.default,function(){})?i.default():i.default):n[o]=i}return n}}),this.assign.apply(this,[e].concat(c(n)))}},{key:"_checkParams",value:function(e){var t=this;if(this._assign(this,this._defaultParams),this.isType(e[0],{}))this.assign(this,e[0]);else if(this.isType(e[0],[])&&(this.task=e[0],this.rejectOnError=e[1]||!1,e[2])){if(!this.isType(e[2],{}))throw this._errorManage("option expect to a object, please check!");this.assign(this,e[2])}var r=function(e){var r=t._defaultParams[e];if(t.isType(r,void 0))return"continue";if(t.isType(r,{})){if(!r.hasOwnProperty("type")||t.isType(t[e],void 0))return"continue";if(r.type=t.isType(r.type,[])?r.type:[r.type],0===r.type.filter(function(r){return r===t[e].constructor}).length){var n=r.type.map(function(e){return e.name});throw t._errorManage(e+" expect to a "+n+" but get a "+t.whatType(t[e])+", please check!")}}else if(!t.isType(r,t[e]))throw t._errorManage(e+" expect to a "+t.whatType(r)+" but get a "+t.whatType(t[e])+", please check!")};for(var n in this._defaultParams)r(n)}},{key:"_initTask",value:function(){var e=0,t=[];for(var r in this.task)t.push({order:e,stepKey:r,handle:this.task[r]}),e++;this.task=this.randomStep?this.shuffle(t):t}},{key:"_initHooks",value:function(){var e=this;if(this.showProgress){var t=this.handleEnd;this.handleEnd=function(){for(var r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];t.apply(e,n),function(t){var r=t.step,n=t.all,o=t.progress;console.log("[ "+e.alias+" ] all: "+n+" complete: "+(r+1)+" progress: "+o)}.apply(e,n)}}}},{key:"_getStepBettwen",value:function(){return this.isType(this.stepBettwen,[])?this.randomNumber.apply(this,c(this.stepBettwen.slice(0,2))):this.stepBettwen}},{key:"_errorManage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unexpected error!";return this.isType(e,"")||(e=e.toString()),new Error("[async-multiple ERROR]: "+e)}},{key:"_makeError",value:function(e){return e instanceof Error?e:e instanceof String?new Error(e):new Error(e.toString())}},{key:"_beginTask",value:function(){var e=this,t=0,r=[],o=function(t,n,o){if(!e._stopAtNextTrick)return e.maxSuccessCount&&r.filter(function(e){return!e.error}).length>=e.maxSuccessCount?(e._debug("Enough success result, task will stop!"),void n(r)):void e.sleep(e._getStepBettwen()).then(function(){t<e.task.length?e._callTaskHandle(t,o):n(r)});n(r)};return this._callTaskHandle(),new Promise(function(i,a){e.event.on(e._actionName,function(u){var s=u.error,c=u.output,l=u.step;if(s){if(e.errorRetry>t)return t+=1,void o(l,i,!0);if(s=e._makeError(s),e.rejectOnError)return a(s)}t=0,r.push(e.removeUndefined(n({},e.task[l],{output:c,error:s,handle:void 0}))),o(l+1,i)})})}},{key:"_debug",value:function(){if(this.debug){for(var e,r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];(e=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_debug",this)).call.apply(e,[this].concat(n))}}},{key:"_callTaskHandle",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t>this.task.length-1||t<0)return Promise.reject(this._errorManage("step overflow!"));var o=u.PENDING,i=null,a=this.task.length,s=function(e){return(100*e/a).toFixed(2)+"%"};this.handleStart&&this.handleStart(n({step:t,all:a,progress:s(t)},this.task[t],{isRetry:r,cancelTask:this.cancelTask.bind(this)}));var c=function(c){if(o===u.PENDING){o=u.REJECT,i&&clearInterval(i);var l=n({},e.task[t],{all:a,progress:s(t+1),output:e._getTaskOutput,error:c,step:t,isRetry:r});e.handleEnd&&e.handleEnd(l),e.event.emit(e._actionName,l)}};this.isType(this.stepTimeout,void 0)||(i=setTimeout(function(){c(e._makeError("timeout!"))},this.stepTimeout)),this.makePromise(this.task[t].handle(this.task[t].input,t,this.cancelTask.bind(this),this.task[t].stepKey)).then(function(c){if(o===u.PENDING){o=u.RESOLVE,i&&clearInterval(i);var l=n({},e.task[t],{all:a,progress:s(t+1),output:c,error:null,step:t,isRetry:r,cancelTask:e.cancelTask.bind(e)});e.handleEnd&&e.handleEnd(l),e.event.emit(e._actionName,l)}},c)}},{key:"_getTaskOutput",get:function(){return this.isType(this.errorReplace,void 0)?null:this.errorReplace}}]),t}();t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"whatType",value:function(e){return Object.prototype.toString.call(e)}},{key:"shuffle",value:function(e){return e.map(function(e){return{v:e,r:Math.random()}}).sort(function(e,t){return e.r-t.r}).map(function(e){return e.v})}},{key:"assign",value:function(){return Object.assign.apply(Object,arguments)}},{key:"isType",value:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return 0===r.map(function(t){return e.whatType(t)===e.whatType(r[0])}).filter(function(e){return!e}).length}},{key:"isPromise",value:function(e){return!(!e.then||!this.isType(e,e.then,function(){}))}},{key:"makePromise",value:function(e){return this.isPromise(e)?e:Promise.resolve(e)}},{key:"arrayToObject",value:function(e){if(!this.isType(e,[]))throw new Error("[arrayToObject error]: expect a array!");var t={};return e.map(function(e,r){t[r]=e}),t}},{key:"sleep",value:function(e){return new Promise(function(t,r){setTimeout(function(){return t("[Sleep]: "+e+"ms")},e)})}},{key:"removeUndefined",value:function(e){if(!this.isType(e,{}))throw new Error("[removeUndefined message]: obj expect a "+this.whatType({}));for(var t in e)this.isType(e[t],void 0)&&delete e[t];return e}},{key:"randomString",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t="",r=function(){var e=Math.floor(62*Math.random());return e<10?e:e<36?String.fromCharCode(e+55):String.fromCharCode(e+61)};t.length<e;)t+=r();return t}},{key:"randomNumber",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this.isType(e,t,1))throw new Error("[randomNumber message]: obj expect a "+this.whatType(1));if(e>t)throw new Error("[randomNumber message]: start number big than end!");var n=Math.random()*(t-e)+e;return r?parseInt(n):n}}]),e}();t.default=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(1));var i=function(e){function t(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).debug,r=void 0!==e&&e;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._callbacks={},n._isDebug=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"on",value:function(e,t,r){this.isType(e,"")||this._errorManage("name expected a string!"),this.isType(t,function(){})||this._errorManage("callback expected a function!"),!this.isType(r,void 0)&&!this.isType(r,1)&&r<=0&&this._errorManage("times expected a number(min 1)!"),this._debug("Add listener for "+e),this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].push({fn:t,times:r})}},{key:"emit",value:function(e){for(var t=this,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];this.isType(e,"")||this._errorManage("name expected a string!"),this._callbacks[e]&&this._callbacks[e].map(function(r,o){if(t.isType(r,{})){var i=r.fn,a=r.times;if(i.apply(void 0,n),!t.isType(a,void 0)){var u=a>1?{fn:i,times:a-1}:void 0;t._callbacks[e].splice(o,1,u)}}})}},{key:"remove",value:function(e){this.isType(e,"")||this._errorManage("name expected a string!"),this._callbacks[e]||this._errorManage("action named "+e+" wasn't bind or removed!"),delete this._callbacks[e]}},{key:"once",value:function(e){return this.on(e,arguments.length<=1?void 0:arguments[1],1)}},{key:"_debug",value:function(e){this._isDebug&&e&&(this.isType(e,"")||(e=e.toString()),console.log("[event MESSAGE]: "+e))}},{key:"_errorManage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unexpected error!";throw this.isType(e,"")||(e=e.toString()),new Error("[event ERROR]: "+e)}}]),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Event=t.Each=t.Map=t.each=t.map=void 0;var n=a(r(4)),o=a(r(0)),i=a(r(2));function a(e){return e&&e.__esModule?e:{default:e}}t.map=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(new(Function.prototype.bind.apply(n.default,[null].concat(t)))).start()},t.each=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(new(Function.prototype.bind.apply(o.default,[null].concat(t)))).start()};t.Map=n.default,t.Each=o.default,t.Event=i.default},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(0));var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._formatType="map",r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"_initTask",value:function(){var e=this,t=0,r=[];for(var n in this.task)r.push({order:t,input:this.task[n],stepKey:n,handle:function(){return e.handle.apply(e,arguments)}}),t++;this.task=this.randomStep?this.shuffle(r):r}}]),t}();t.default=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=a(r(1)),i=a(r(2));function a(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.event=new i.default,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.default),n(t,[{key:"_errorManage",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unexpected error!";return this.isType(e,"")||(e=e.toString()),new Error("[async-multiple ERROR]: "+e)}},{key:"_debug",value:function(e){e&&(this.isType(e,"")||(e=e.toString()),console.log("[async-multiple MESSAGE]: "+e))}}]),t}();t.default=u},function(e,t,r){"use strict";!function(t){e.exports=t()}(function(){return function(e,t,r){var n=Object.prototype.toString.call(e);if("[object Array]"!==n)throw new TypeError("orderBy only takes array parameter. Found: "+n);if("string"!=typeof t)throw new TypeError("orderBy expects to take a string parameter. Found: "+typeof t);r="boolean"==typeof r&&r;var o={},i=[];e.forEach(function(e,r){var n=e[t];o[e[t]]=r,i.push(n)}),i.sort(),r&&i.reverse();var a=[];return i.forEach(function(t){a.push(e[o[t]])}),a}})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.PENDING="PENDING",t.RESOLVE="RESOLVE",t.REJECT="REJECT"}])});